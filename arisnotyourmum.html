<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<link rel="stylesheet" title="Tomorrow Night Bright" href="styles/tomorrow-night-bright.css">
<script src="highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<style type='text/css'>
body {
  font-family: 'Helvetica';
  letter-spacing:-5px;
  background:#222;
  background-size:100%;
  color:#fff;
  margin:0;
  padding:0;
  font-weight:bold;
  font-size: 15vw;
  vertical-align: middle;
}

h1, h2, h3, p {
  margin:0;
}

pre {
  white-space: pre-wrap;
  margin: 0 !important;
  padding: 0 !important;
}

pre.nopad {
  margin: 0 !important;
  padding: 0 !important;
}

pre.nopad code {
  margin: 0 !important;
  padding: 0 !important;
  font-size: 1.5vw !important;
}

em, a {
  font-style:normal;
  color:#8dbd0c;
}

a {
  background: #34d0e7;
  color:#000;
  text-decoration:none;
  font-size: 6vw;
}

sub {
  display: block;
  font-size: 6vw;
  color: #62FF00;
}
sub.white {
  color: white;
}

code {
  display: inline-block;
  font-family: Monaco;
  font-size: 3vw;
  letter-spacing:2px;
  margin-left: 2em;
  margin-top: 20px;
}

code.smaller {
  font-size: 34px;
}


img {
  width:100%;
}

div {
  cursor:pointer;
  cursor:hand;
  position:absolute;
  top:0;
  left:0;
  max-width: 100%;
}
</style><script type='text/javascript'>
window.onload = function() {
    var s = document.getElementsByTagName('div'), cur = 0;
    if (!s) return;
    function go(n) {
        cur = n;
        var i = 1e3, e = s[n];
        for (var k = 0; k < s.length; k++) s[k].style.display = 'none';
        e.style.display = 'inline-block';
        if (e.firstChild.nodeName === 'IMG') {
            document.body.style.backgroundImage = 'url(' + e.firstChild.src + ')';
            e.firstChild.style.display = 'none';
        } else {
            document.body.style.backgroundImage = '';
        }
        if (window.location.hash !== n) window.location.hash = n;
    }
    document.onclick = function() {
        go(++cur % (s.length));
    };
    document.onkeydown = function(e) {
        (e.which === 39) && go(Math.min(s.length - 1, ++cur));
        (e.which === 37) && go(Math.max(0, --cur));
    };
    function parse_hash() {
        return Math.max(Math.min(
            s.length - 1,
            parseInt(window.location.hash.substring(1), 10)), 0);
    };
    if (window.location.hash) cur = parse_hash() || cur;
    window.onhashchange = function() {
        var c = parse_hash();
        if (c !== cur) go(c);
    };

    go(cur);
};
</script></head><body>
<div>Hi, I'm Leonard - <a href="https://twitter.com/lgarvey">@lgarvey</a>
  <sub>"Lead" Dev @ <a href="https://www.airtasker.com">Airtasker</a></sub>
</div>
<div><em>A</em>ctive <em>R</em>ecord</div>
<div>ain't your <em>mum</em></div>
<div>Go and <em>learn</em> SQL</div>
<div>at least <em>think</em> what SQL AR makes</div>
<div><em>at least</em> think</div>
<div>
  <pre>
<code class="ruby">
@tasks = Task.limit(9001)
</code>
  </pre>
</div>

<div>
  <pre>
<code class="ruby">
@tasks = Task.limit(9001)

## SELECT "tasks".* FROM "tasks" LIMIT 9001
</code>
  </pre>
</div>


  <div>
<pre>
<code class="ruby">
= render @tasks
## then inside that partial
.sender-name= task.sender.name
  %div.sender-name= task.sender.name
  -# obediently loops through all the @tasks
  -# which is probably not what you want
</code>
</pre>
</div>

<div>
  <pre class="nopad">
<code class="ruby">
  User Load (0.6ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 2 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 4 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 6 LIMIT 1
  User Load (0.5ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 7 LIMIT 1
  User Load (0.5ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 8 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 9 LIMIT 1
  User Load (0.6ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 10 LIMIT 1
  User Load (0.5ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 11 LIMIT 1
  User Load (0.5ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 12 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 13 LIMIT 1
  User Load (0.5ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 14 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 15 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 17 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 18 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 19 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 20 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 21 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 22 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 23 LIMIT 1
  User Load (0.5ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 24 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 25 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 26 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 27 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 28 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 29 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 30 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 31 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 32 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 33 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 34 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 35 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 36 LIMIT 1
  User Load (0.5ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 37 LIMIT 1
  User Load (0.4ms)  SELECT "users".* FROM "users" WHERE "users"."id" = 1 LIMIT 1
</code>
  </pre>
</div>

<div>
  This is <em>shit</em>
</div>

<div>
  <pre>
<code class="ruby">
@tasks = Task.limit(9001).includes(:sender)
</code>
  </pre>
</div>

<div>
  <pre class="nopad">
<code class="ruby">
  Task Load (4.2ms)  SELECT "tasks".* FROM "tasks" LIMIT 9001
  User Load (5.0ms)  SELECT "users".* FROM "users" WHERE "users"."id" IN (2, 4, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 1, 16, 5, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 94, 95, 96, 97, 98, 99, 100, 103, 106, 115, 93, 38, 116, 117, 118, 119, 120, 121, 122, 123, 124, 155, 156, 157, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255, 256, 257, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, 277, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300, 301, 302, 303, 304, 305, 306, 307, 308, 309, 310, 311, 312, 313, 314, 315, 316, 317, 318, 319, 320, 321, 323, 324, 325, 333, 332, 326, 322, 107, 3)
</code>
  </pre>
</div>

<div>
<em>Much</em> better
</div>

<div>
  Or a <em>complex</em> version
</div>
<div>
  <pre>
<code class="ruby">
@tasks = Task.limit(9001).includes({:locations => :postcode}, :sender)
</code>
  </pre>
</div>
<div>
  Use bullet
  <a href="https://github.com/flyerhzm/bullet">https://github.com/flyerhzm/bullet</a>
</div>
<div>
  <em>Join</em>ing
</div>
<div>
  Huge part of SQL. <sub>AR dislikes relational integrity at the db level</sub>
</div>

<div>
<pre>
<code class="ruby">
@tasks = Task.limit(9001).joins(:sender)
</code>
</pre>
</div>

<div>
<pre>
<code class="ruby">
@tasks = Task.limit(9001).joins(:sender)

## SELECT "tasks".* FROM "tasks" INNER JOIN "users" ON "users"."id" = "tasks"."sender_id" LIMIT 9001

## Give me the tasks that have a sender
## N+1 watchout!
</code>
</pre>
</div>

<div>
  <em>Count</em>ing
</div>

<div>
  <pre>
<code class="ruby">
task.comments.count

## SELECT COUNT(*) FROM "comments" WHERE "comments"."commentable_id" = 316 AND "comments"."commentable_type" = 'Task'
</code>
</pre>
</div>

<div>
  <pre>
<code class="ruby">
task.comments_count

## just loads the comment_count attribute.
## Faster in Postgres.
## Probably faster in MySQL.
</code>
</pre>
</div>

<div>
  <sub>Pay attention to console and logs</sub>
  <sub class="white">Know what SQL you want to generate</sub>
  <sub>Understand your database</sub>
</div>

<div>
  <sub>Pay attention to console and logs</sub>
  <sub class="white">Know what SQL you want to generate</sub>
  <sub>Understand your database</sub>
  Do your <em>job</em>
</div>

<div></div>
